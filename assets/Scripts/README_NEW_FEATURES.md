# 新功能使用说明

## 概述

游戏已扩展为完整的塔防系统，包含商店、多种防御塔、30波敌人等完整功能。

## 新增功能

### 1. 防御塔系统

#### 6种防御塔（3白2绿1蓝）

**白色品质（3个）：**
- **弓箭手** (tower_archer) - 30金币
  - 基础物理攻击，平衡型
  - 攻击间隔：1.0秒，范围：250

- **法师** (tower_mage) - 35金币
  - 基础魔法攻击，高伤害
  - 攻击间隔：1.2秒，范围：280

- **守卫** (tower_guard) - 40金币
  - 高伤害但攻击慢
  - 攻击间隔：1.5秒，范围：200

**绿色品质（2个）：**
- **寒冰塔** (tower_ice) - 60金币
  - 技能：减速30%
  - 攻击附带减速效果

- **火炮** (tower_cannon) - 70金币
  - 技能：溅射伤害50%
  - 范围溅射攻击

**蓝色品质（1个）：**
- **闪电塔** (tower_lightning) - 100金币
  - 技能：连锁攻击3个敌人
  - 伤害递减，冷却3秒

#### 防御塔等级系统
- 所有防御塔初始为LV1
- 通过合并同类型同等级塔升级
- 最高等级：LV4
- 每级属性提升20%

#### 防御塔类型（用于未来羁绊）
- PHYSICAL（物理型）
- MAGIC（魔法型）
- SUPPORT（辅助型）
- AOE（范围型）

### 2. 商店系统

#### 功能
- 每次显示4张防御塔卡片
- 可用2金币刷新商店
- 每波开始时自动刷新
- 购买后点击地图放置

#### 使用方法
1. 在商店中点击防御塔卡片购买
2. 购买后，点击地图上的空位放置
3. 点击刷新按钮（消耗2金币）手动刷新

#### UI结构要求
商店卡片预制体需要包含：
- `NameLabel` - 显示防御塔名称（会根据品质变色）
- `CostLabel` - 显示价格
- `DescLabel` - 显示描述
- `BuyButton` - 购买按钮

### 3. 波次系统（30波）

#### 波次配置
- **总波数**：30波
- **精英波**：第15波、第25波
- **Boss波**：第30波

#### 敌人分布
- **1-5波**：只有普通敌人
- **6-10波**：开始出现快速敌人（30%概率）
- **11-20波**：三种类型混合（普通50%，快速30%，坦克20%）
- **21-29波**：更多坦克（普通40%，快速30%，坦克30%）

#### 精英波和Boss波
- **精英波**：敌人数量较少但血量1.5倍，生成间隔2秒
- **Boss波**：1个Boss，血量3倍，间隔6秒

#### 自适应生成
- 生成间隔随波次递减（1.5秒 → 0.5秒）
- 敌人数量随波次递增（5个 → 50个）

### 4. 技能系统

#### 技能类型
- **减速** (SLOW)：降低敌人移动速度
- **溅射** (SPLASH)：对周围敌人造成伤害
- **连锁** (CHAIN)：攻击可跳跃到多个敌人
- **AOE伤害** (AOE_DAMAGE)：范围伤害技能
- **伤害Buff** (BUFF_DAMAGE)：增加友军伤害
- **速度Buff** (BUFF_SPEED)：增加友军攻击速度

## 在Cocos Creator中设置

### 1. 替换EnemySpawner为WaveSystem

1. 删除或禁用 `EnemySpawner` 组件
2. 在Canvas或相应节点上添加 `WaveSystem` 组件
3. 设置属性：
   - `Enemy Prefab`: 普通敌人预制体
   - `Elite Enemy Prefab`: 精英敌人预制体（可选，可复用普通）
   - `Boss Enemy Prefab`: Boss预制体（可选，可复用普通）
   - `Wave Label`: 波次显示Label

### 2. 添加商店系统

1. 创建商店UI节点
2. 添加 `ShopSystem` 组件
3. 设置属性：
   - `Shop Panel`: 商店面板节点
   - `Card Container`: 卡片容器节点
   - `Card Prefab`: 商店卡片预制体
   - `Refresh Button`: 刷新按钮
   - `Refresh Cost Label`: 刷新费用显示

### 3. 更新防御塔预制体

确保防御塔预制体包含：
- `Tower` 组件
- `Sprite` 组件（用于显示品质颜色）
- `Label` 组件（用于显示等级）

### 4. 更新TouchManager

`TouchManager` 已自动支持：
- 从商店购买防御塔
- 同类型同等级合并（最高LV4）
- 品质显示

## 防御塔定价说明

根据游戏节奏设计：
- **白色品质**：30-40金币（前期可负担）
- **绿色品质**：60-70金币（中期主力）
- **蓝色品质**：100金币（后期核心）

定价考虑了：
- 金币获取节奏（每波约10-30金币）
- 防御塔强度差异
- 游戏进度平衡

## 注意事项

1. **商店卡片UI**：需要创建商店卡片预制体，包含上述UI元素
2. **防御塔初始化**：购买后需要点击地图放置，防御塔会自动初始化
3. **合并限制**：只能合并同类型同等级，且不能超过LV4
4. **波次系统**：如果使用WaveSystem，记得移除或禁用旧的EnemySpawner
5. **品质显示**：防御塔Sprite颜色会根据品质自动变化

## 未来扩展

系统已预留：
- 防御塔类型（Category）用于羁绊系统
- 技能系统可轻松扩展新技能
- 波次配置可灵活调整
- 商店系统支持扩展更多功能

## 代码文件说明

- `TowerType.ts` - 防御塔类型、品质、技能定义
- `ShopSystem.ts` - 商店系统
- `WaveSystem.ts` - 波次系统（替代EnemySpawner）
- `Tower.ts` - 更新的防御塔系统（支持品质、技能、LV4上限）
- `Bullet.ts` - 更新的子弹系统（支持技能效果）
- `TouchManager.ts` - 更新的触摸管理（支持商店购买）
