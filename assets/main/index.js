System.register("chunks:///_virtual/Bullet.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enemy.ts","./GameConfig.ts","./TowerType.ts"],(function(t){var e,i,a,n,o,s,r,l,c,p;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,a=t._decorator,n=t.v3,o=t.Vec3,s=t.find,r=t.Component},function(t){l=t.Enemy},function(t){c=t.GameConfig},function(t){p=t.SkillType}],execute:function(){var u;i._RF.push({},"0edb43CQZ5FwoUCAtBQQ4rv","Bullet",void 0);var d=a.ccclass;a.property,t("Bullet",d("Bullet")(u=function(t){function i(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).damage=c.TOWER_BASE_DAMAGE,e.target=null,e.speed=c.BULLET_SPEED,e.towerData=null,e.towerLevel=1,e}e(i,t);var a=i.prototype;return a.setTarget=function(t){this.target=t},a.update=function(t){if(this.target&&this.target.isValid){var e=this.node.getPosition(),i=this.target.getPosition(),a=n();o.subtract(a,i,e),a.length()<c.BULLET_HIT_DISTANCE?(this.onHit(this.target),this.node.destroy()):(a.normalize(),this.node.setPosition(e.add(a.multiplyScalar(this.speed*t))))}else this.node.destroy()},a.onHit=function(t){var e=t.getComponent(l);if(e&&(e.takeDamage(this.damage),this.towerData)){var i=this.towerData.skillType,a=this.towerData.skillValue;switch(i){case p.SLOW:this.applySlow(t,a);break;case p.SPLASH:this.applySplash(t,a);break;case p.CHAIN:this.applyChain(t,a)}}},a.applySlow=function(t,e){var i=t.getComponent(l);if(i){var a=i.originalSpeed||i.speed;i.originalSpeed||(i.originalSpeed=i.speed),i.speed=a*(1-e),setTimeout((function(){i&&i.node&&i.node.isValid&&(i.speed=a)}),3e3)}},a.applySplash=function(t,e){var i=s("Canvas");if(i){var a=t.getPosition(),n=this.damage*e;i.children.forEach((function(e){if("Enemy"===e.name&&e!==t&&e.isValid&&o.distance(a,e.getPosition())<=80){var i=e.getComponent(l);i&&i.takeDamage(n)}}))}},a.applyChain=function(t,e){var i=s("Canvas");if(i)for(var a=t,n=.8*this.damage,r=function(){if(!a||!a.isValid)return 0;var t=a.getPosition(),e=null,s=150;if(i.children.forEach((function(i){if("Enemy"===i.name&&i!==a&&i.isValid){var n=o.distance(t,i.getPosition());n<s&&(s=n,e=i)}})),!e)return 0;var r=e.getComponent(l);r&&r.takeDamage(n),a=e,n*=.8},c=0;c<e&&0!==r();c++);},i}(r))||u);i._RF.pop()}}}));

System.register("chunks:///_virtual/Enemy.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TouchManager.ts","./TileSlot.ts","./GameConfig.ts"],(function(t){var i,e,n,o,s,a,r,p,h,l,E,u,c,d,_,y,P,A,f;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,s=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,r=t._decorator,p=t.Node,h=t.Label,l=t.Sprite,E=t.Color,u=t.v3,c=t.find,d=t.Vec3,_=t.Component},function(t){y=t.TouchManager},function(t){P=t.TileSlot,A=t.TileType},function(t){f=t.GameConfig}],execute:function(){var g,M,S,N,T,m,b,H,v;a._RF.push({},"8e81e2IdtJDrKVkWd7iLjpn","Enemy",void 0);var I=r.ccclass,R=r.property,L=t("EnemyType",function(t){return t[t.NORMAL=0]="NORMAL",t[t.FAST=1]="FAST",t[t.TANK=2]="TANK",t}({}));t("Enemy",(g=I("Enemy"),M=R(p),S=R(h),N=R(l),g((b=i((m=function(t){function i(){for(var i,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return i=t.call.apply(t,[this].concat(s))||this,n(i,"hpFillBar",b,o(i)),n(i,"hpLabel",H,o(i)),n(i,"bodySprite",v,o(i)),i.hp=3,i.maxHp=3,i.speed=100,i.waypointPositions=[],i.currentWaypointIndex=0,i.gridMap=null,i}e(i,t);var a=i.prototype;return a.init=function(t,i){void 0===i&&(i=L.NORMAL);var e=t-1;i===L.FAST?(this.maxHp=Math.floor((f.ENEMY_BASE_HP+e*f.ENEMY_HP_PER_WAVE)*f.FAST_ENEMY_HP_MULTIPLIER),this.speed=f.FAST_ENEMY_BASE_SPEED+e*f.FAST_ENEMY_SPEED_PER_WAVE,this.bodySprite&&(this.bodySprite.color=E.GREEN)):i===L.TANK?(this.maxHp=f.TANK_ENEMY_BASE_HP+e*f.TANK_ENEMY_HP_PER_WAVE,this.speed=f.TANK_ENEMY_BASE_SPEED+e*f.TANK_ENEMY_SPEED_PER_WAVE,this.bodySprite&&(this.bodySprite.color=E.MAGENTA)):(this.maxHp=f.ENEMY_BASE_HP+e*f.ENEMY_HP_PER_WAVE,this.speed=f.ENEMY_BASE_SPEED+e*f.ENEMY_SPEED_PER_WAVE,this.bodySprite&&(this.bodySprite.color=E.WHITE)),this.hp=this.maxHp,this.updateHealthUI()},a.updateHealthUI=function(){this.hpFillBar&&this.hpFillBar.setScale(u(Math.max(0,this.hp/this.maxHp),1,1)),this.hpLabel&&(this.hpLabel.string=Math.max(0,this.hp)+"/"+this.maxHp)},a.takeDamage=function(t){this.hp-=t,this.updateHealthUI(),this.hp<=0&&this.node&&this.node.isValid&&(y.money+=f.ENEMY_KILL_REWARD,this.node.destroy())},a.start=function(){this.gridMap=c("Canvas/GridMap"),this.generatePath()},a.generatePath=function(){if(this.gridMap||(this.gridMap=c("Canvas/GridMap")),this.gridMap){for(var t,i=null,e=null,n=[],o=s(this.gridMap.children);!(t=o()).done;){var a=t.value,r=a.getComponent(P);r&&(r.type===A.START?i=a:r.type===A.END?e=a:r.type===A.PATH&&n.push(a))}if(i&&e){this.waypointPositions=[i.getPosition()];for(var p=i.getPosition(),h=[].concat(n),l=e.getPosition();h.length>0;){h.sort((function(t,i){var e=t.getPosition(),n=i.getPosition(),o=d.distance(e,p),s=d.distance(n,p);return o+.3*d.distance(e,l)-(s+.3*d.distance(n,l))}));var E=h.shift();this.waypointPositions.push(E.getPosition()),p=E.getPosition()}this.waypointPositions.push(l)}}},a.update=function(t){if(!(0===this.waypointPositions.length||y.isGameOver||this.currentWaypointIndex>=this.waypointPositions.length)){var i=this.waypointPositions[this.currentWaypointIndex],e=this.node.getPosition(),n=u();d.subtract(n,i,e),n.length()<f.ENEMY_WAYPOINT_REACH_DISTANCE?(this.currentWaypointIndex++,this.currentWaypointIndex>=this.waypointPositions.length&&(y.baseHealth-=1,this.node.destroy())):(n.normalize(),this.node.setPosition(e.add(n.multiplyScalar(this.speed*t))))}},i}(_)).prototype,"hpFillBar",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=i(m.prototype,"hpLabel",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=i(m.prototype,"bodySprite",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=m))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/EnemySpawner.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileSlot.ts","./Enemy.ts","./TouchManager.ts","./GameConfig.ts"],(function(e){var n,a,i,t,r,s,o,c,p,l,u,v,h,f,m,E,T;return{setters:[function(e){n=e.applyDecoratedDescriptor,a=e.inheritsLoose,i=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,o=e.Prefab,c=e.Label,p=e.find,l=e.instantiate,u=e.Component},function(e){v=e.TileSlot,h=e.TileType},function(e){f=e.Enemy,m=e.EnemyType},function(e){E=e.TouchManager},function(e){T=e.GameConfig}],execute:function(){var y,_,w,d,A,g,M;r._RF.push({},"025f6QPXHZIeb2Cxen2lpPg","EnemySpawner",void 0);var N=s.ccclass,C=s.property;e("EnemySpawner",(y=N("EnemySpawner"),_=C(o),w=C(c),y((g=n((A=function(e){function n(){for(var n,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return n=e.call.apply(e,[this].concat(r))||this,i(n,"enemyPrefab",g,t(n)),i(n,"waveLabel",M,t(n)),n.currentWave=1,n.enemiesLeftToSpawn=T.INITIAL_WAVE_ENEMY_COUNT,n.spawnTimer=0,n.waveGapTimer=0,n.canvas=null,n.gridMap=null,n}a(n,e);var r=n.prototype;return r.start=function(){this.canvas=p("Canvas"),this.gridMap=p("Canvas/GridMap")},r.update=function(e){var n;E.isGameOver||(this.waveLabel&&(this.waveLabel.string="WAVE: "+this.currentWave),this.enemiesLeftToSpawn>0?(this.spawnTimer+=e,this.spawnTimer>=T.ENEMY_SPAWN_INTERVAL&&(this.spawnEnemyByWave(),this.enemiesLeftToSpawn--,this.spawnTimer=0)):(this.canvas||(this.canvas=p("Canvas")),0===((null==(n=this.canvas)?void 0:n.children.filter((function(e){return"Enemy"===e.name})))||[]).length&&(this.waveGapTimer+=e,this.waveGapTimer>=T.WAVE_GAP_TIME&&(this.currentWave++,this.enemiesLeftToSpawn=T.INITIAL_WAVE_ENEMY_COUNT+this.currentWave*T.ENEMY_COUNT_PER_WAVE,this.waveGapTimer=0))))},r.spawnEnemyByWave=function(){if(this.gridMap||(this.gridMap=p("Canvas/GridMap")),this.gridMap){var e=this.gridMap.children.find((function(e){var n=e.getComponent(v);return n&&n.type===h.START}));if(e){var n=l(this.enemyPrefab);if(this.canvas||(this.canvas=p("Canvas")),this.canvas){this.canvas.addChild(n),n.name="Enemy",n.setPosition(e.getPosition());var a=n.getComponent(f);if(a){var i=m.NORMAL;if(this.currentWave>T.ENEMY_TYPE_RANDOM_START_WAVE){var t=Math.random();t<T.FAST_ENEMY_SPAWN_CHANCE?i=m.FAST:t<T.TANK_ENEMY_SPAWN_CHANCE&&(i=m.TANK)}a.init(this.currentWave,i)}}else n.destroy()}}},n}(u)).prototype,"enemyPrefab",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(A.prototype,"waveLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=A))||d));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameConfig.ts",["cc"],(function(E){var _;return{setters:[function(E){_=E.cclegacy}],execute:function(){_._RF.push({},"39a78CsyStI5IpgAl97Vc1R","GameConfig",void 0);var A=E("GameConfig",(function(){}));A.INITIAL_MONEY=200,A.INITIAL_HEALTH=10,A.TOWER_COST=50,A.TOWER_ATTACK_RANGE=250,A.TOWER_BASE_ATTACK_INTERVAL=1.2,A.TOWER_MIN_ATTACK_INTERVAL=.3,A.TOWER_ATTACK_INTERVAL_REDUCTION_PER_LEVEL=.1,A.TOWER_BASE_DAMAGE=1,A.TOWER_SCALE_PER_LEVEL=.1,A.ENEMY_KILL_REWARD=10,A.ENEMY_BASE_HP=3,A.ENEMY_HP_PER_WAVE=5,A.ENEMY_BASE_SPEED=100,A.ENEMY_SPEED_PER_WAVE=3,A.FAST_ENEMY_HP_MULTIPLIER=.7,A.FAST_ENEMY_BASE_SPEED=180,A.FAST_ENEMY_SPEED_PER_WAVE=5,A.TANK_ENEMY_BASE_HP=10,A.TANK_ENEMY_HP_PER_WAVE=10,A.TANK_ENEMY_BASE_SPEED=60,A.TANK_ENEMY_SPEED_PER_WAVE=2,A.INITIAL_WAVE_ENEMY_COUNT=5,A.ENEMY_COUNT_PER_WAVE=2,A.ENEMY_SPAWN_INTERVAL=1.2,A.WAVE_GAP_TIME=4,A.ENEMY_TYPE_RANDOM_START_WAVE=3,A.FAST_ENEMY_SPAWN_CHANCE=.3,A.TANK_ENEMY_SPAWN_CHANCE=.5,A.BULLET_SPEED=800,A.BULLET_HIT_DISTANCE=10,A.ENEMY_WAYPOINT_REACH_DISTANCE=5,A.TILE_DETECTION_RADIUS=50,A.TOWER_DETECTION_RADIUS=20,A.OCCUPIED_CLEAR_DISTANCE=10,_._RF.pop()}}}));

System.register("chunks:///_virtual/GridGenerator.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,i,n,a,o,l,c,u,s;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Prefab,c=e.instantiate,u=e.v3,s=e.Component}],execute:function(){var d,p,f,h,g,b,v;a._RF.push({},"c1d8cvYX7tDU7XjqSLQtzDr","GridGenerator",void 0);var y=o.ccclass,z=o.property,G=o.executeInEditMode;e("GridGenerator",(d=y("GridGenerator"),p=z(l),d(f=G((g=r((h=function(e){function r(){for(var r,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return r=e.call.apply(e,[this].concat(a))||this,i(r,"tilePrefab",g,n(r)),i(r,"gridSize",b,n(r)),i(r,"generate",v,n(r)),r}t(r,e);var a=r.prototype;return a.update=function(){this.generate&&(this.generate=!1,this.createGrid())},a.createGrid=function(){this.node.removeAllChildren();for(var e=0;e<18;e++)for(var r=0;r<10;r++){var t=c(this.tilePrefab);this.node.addChild(t);var i=(r-4.5)*this.gridSize,n=(e-8.5)*this.gridSize;t.setPosition(u(i,n,0)),t.name="Tile_"+e+"_"+r}console.log("网格生成完成，请开始设计地图布局")},r}(s)).prototype,"tilePrefab",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=r(h.prototype,"gridSize",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 75}}),v=r(h.prototype,"generate",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),f=h))||f)||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/LevelData.ts",["cc","./TileSlot.ts"],(function(e){var t,n;return{setters:[function(e){t=e.cclegacy},function(e){n=e.TileType}],execute:function(){t._RF.push({},"44967xCUl5Ho5hQQAPQ+6zZ","LevelData",void 0),e("LevelConfig",function(){function e(){}return e.numberToTileType=function(e){switch(e){case 0:return n.VOID;case 1:return n.PATH;case 2:return n.EMPTY;case 3:return n.START;case 4:return n.END;default:return n.EMPTY}},e}()).DEFAULT_LEVEL={id:1,name:"默认关卡",layout:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]]},t._RF.pop()}}}));

System.register("chunks:///_virtual/LevelLoader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileSlot.ts","./LevelData.ts"],(function(e){var r,t,n,i,o,a,l,u,s,c,f,p,v,d,h,L;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,o=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){l=e.cclegacy,u=e._decorator,s=e.Prefab,c=e.Component,f=e.instantiate,p=e.v3,v=e.resources,d=e.JsonAsset},function(e){h=e.TileSlot},function(e){L=e.LevelConfig}],execute:function(){var g,b,y,m,P,D,T;l._RF.push({},"d83det8RYpFar6FhUoVCPtV","LevelLoader",void 0);var w=u.ccclass,C=u.property;e("LevelLoader",(g=w("LevelLoader"),b=C(s),g((P=r((m=function(e){function r(){for(var r,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o))||this,n(r,"tilePrefab",P,i(r)),n(r,"gridSize",D,i(r)),n(r,"levelConfigPath",T,i(r)),r.currentLevelData=null,r}t(r,e);var l=r.prototype;return l.loadLevelFromJson=function(){var e=o(a().mark((function e(r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){v.load(r,d,(function(t,n){if(t)return console.warn("无法加载关卡配置 "+r+"，使用默认关卡",t),void e(L.DEFAULT_LEVEL);try{var i=n.json;e(i)}catch(t){console.error("解析关卡配置失败: "+r,t),e(L.DEFAULT_LEVEL)}}))})));case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),l.generateLevel=function(){var e=o(a().mark((function e(r){var t,n,i,o,l,u,s,c,v,d,g,b,y,m;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return e.next=3,this.loadLevelFromJson(this.levelConfigPath);case 3:r=e.sent;case 4:for(r||(console.error("无法加载关卡数据，使用默认关卡"),r=L.DEFAULT_LEVEL),this.currentLevelData=r,this.node.removeAllChildren(),n=r.layout,i=n.length,o=(null==(t=n[0])?void 0:t.length)||10,l=0;l<i;l++)for(u=0;u<o;u++)v=null!=(s=null==(c=n[l])?void 0:c[u])?s:2,d=L.numberToTileType(v),g=f(this.tilePrefab),this.node.addChild(g),b=(u-(o-1)/2)*this.gridSize,y=((i-1)/2-l)*this.gridSize,g.setPosition(p(b,y,0)),(m=g.getComponent(h))&&(m.type=d,m.updateVisual()),g.name="Tile_"+l+"_"+u;return console.log('关卡 "'+r.name+'" 生成完成'),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),l.getCurrentLevelData=function(){return this.currentLevelData},r}(c)).prototype,"tilePrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=r(m.prototype,"gridSize",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 75}}),T=r(m.prototype,"levelConfigPath",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"levels/level1"}}),y=m))||y));l._RF.pop()}}}));

System.register("chunks:///_virtual/LevelManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LevelLoader.ts","./TouchManager.ts","./GameConfig.ts"],(function(e){var t,r,n,a,o,i,l,s,d,c,u,v,L,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,i=e.regeneratorRuntime},function(e){l=e.cclegacy,s=e._decorator,d=e.Node,c=e.find,u=e.Component},function(e){v=e.LevelLoader},function(e){L=e.TouchManager},function(e){h=e.GameConfig}],execute:function(){var p,f,g,M,m;l._RF.push({},"f21a7koq7dCip4CoDP0HHmi","LevelManager",void 0);var y=s.ccclass,I=s.property;e("LevelManager",(p=y("LevelManager"),f=I(d),p((m=t((M=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=e.call.apply(e,[this].concat(o))||this,n(t,"gridMapNode",m,a(t)),t.currentLevelId=1,t.levelLoader=null,t}r(t,e);var l=t.prototype;return l.start=function(){if(this.gridMapNode)this.levelLoader=this.gridMapNode.getComponent(v),this.levelLoader||(this.levelLoader=this.gridMapNode.addComponent(v));else{var e=c("Canvas/GridMap");e&&(this.gridMapNode=e,this.levelLoader=e.getComponent(v),this.levelLoader||(this.levelLoader=e.addComponent(v)))}this.loadLevel(this.currentLevelId)},l.loadLevel=function(){var e=o(i().mark((function e(t){var r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.levelLoader){e.next=3;break}return console.error("LevelLoader未找到"),e.abrupt("return");case 3:return this.currentLevelId=t,r="levels/level"+t,this.levelLoader.levelConfigPath=r,e.next=8,this.levelLoader.generateLevel();case 8:(n=e.sent)&&(void 0!==n.initialMoney?L.money=n.initialMoney:L.money=h.INITIAL_MONEY,void 0!==n.initialHealth?L.baseHealth=n.initialHealth:L.baseHealth=h.INITIAL_HEALTH,L.isGameOver=!1,console.log("关卡 "+t+" 加载完成: "+n.name));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),l.reloadCurrentLevel=function(){this.loadLevel(this.currentLevelId)},l.loadNextLevel=function(){this.loadLevel(this.currentLevelId+1)},l.getCurrentLevelId=function(){return this.currentLevelId},t}(u)).prototype,"gridMapNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=M))||g));l._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./Bullet.ts","./Enemy.ts","./EnemySpawner.ts","./GameConfig.ts","./GridGenerator.ts","./LevelData.ts","./LevelLoader.ts","./LevelManager.ts","./ShopCard.ts","./ShopSystem.ts","./TileSlot.ts","./TouchManager.ts","./Tower.ts","./TowerType.ts","./UIBuilder.ts","./UIController.ts","./WaveSystem.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/ShopCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TowerType.ts","./TouchManager.ts"],(function(t){var e,a,r,i,o,n,s,u,l,c,b,h,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){o=t.cclegacy,n=t._decorator,s=t.Label,u=t.Button,l=t.Sprite,c=t.Color,b=t.Component},function(t){h=t.TowerConfig},function(t){p=t.TouchManager}],execute:function(){var f,w,y,g,d,D,m,L,C,S,B,v,T;o._RF.push({},"fb21f9Nu4JPBLAtrtGvAheC","ShopCard",void 0);var z=n.ccclass,R=n.property;t("ShopCard",(f=z("ShopCard"),w=R(s),y=R(s),g=R(s),d=R(u),D=R(l),f((C=e((L=function(t){function e(){for(var e,a=arguments.length,o=new Array(a),n=0;n<a;n++)o[n]=arguments[n];return e=t.call.apply(t,[this].concat(o))||this,r(e,"nameLabel",C,i(e)),r(e,"costLabel",S,i(e)),r(e,"descLabel",B,i(e)),r(e,"buyButton",v,i(e)),r(e,"bgSprite",T,i(e)),e.towerData=null,e}a(e,t);var o=e.prototype;return o.setTowerData=function(t){this.towerData=t,this.updateUI()},o.updateUI=function(){if(this.towerData){if(this.nameLabel&&(this.nameLabel.string=this.towerData.name,this.nameLabel.color=h.getRarityColor(this.towerData.rarity)),this.costLabel&&(this.costLabel.string=""+this.towerData.baseCost),this.descLabel&&(this.descLabel.string=this.towerData.description),this.bgSprite){var t=h.getRarityColor(this.towerData.rarity);this.bgSprite.color=new c(t.r,t.g,t.b,100)}this.updateButtonState()}},o.updateButtonState=function(){if(this.buyButton&&this.towerData){var t=p.money>=this.towerData.baseCost;this.buyButton.interactable=t,this.buyButton.normalColor=t?new c(50,200,50):new c(100,100,100)}},o.onBuyClick=function(){this.towerData&&p.money>=this.towerData.baseCost&&(p.money-=this.towerData.baseCost,p.pendingTowerData=this.towerData,console.log("购买了 "+this.towerData.name+"，请点击地图放置"),this.updateButtonState())},o.update=function(){this.towerData&&this.updateButtonState()},e}(b)).prototype,"nameLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(L.prototype,"costLabel",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=e(L.prototype,"descLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=e(L.prototype,"buyButton",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(L.prototype,"bgSprite",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=L))||m));o._RF.pop()}}}));

System.register("chunks:///_virtual/ShopSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TowerType.ts","./TouchManager.ts","./WaveSystem.ts","./ShopCard.ts"],(function(e){var t,n,r,o,i,a,s,l,d,h,c,u,C,f,p,g,m,v,b,S,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,a=e._decorator,s=e.Node,l=e.Prefab,d=e.Button,h=e.Label,c=e.instantiate,u=e.UITransform,C=e.Widget,f=e.Sprite,p=e.Color,g=e.Component},function(e){m=e.TowerRarity,v=e.TowerConfig},function(e){b=e.TouchManager},function(e){S=e.WaveSystem},function(e){y=e.ShopCard}],execute:function(){var R,T,L,w,A,B,E,N,z,P,W,_,O;i._RF.push({},"4cca91livJKKr2sc3k4DvoY","ShopSystem",void 0);var D=a.ccclass,H=a.property;e("ShopSystem",(R=D("ShopSystem"),T=H(s),L=H(s),w=H(l),A=H(d),B=H(h),R((z=t((N=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"shopPanel",z,o(t)),r(t,"cardContainer",P,o(t)),r(t,"cardPrefab",W,o(t)),r(t,"refreshButton",_,o(t)),r(t,"refreshCostLabel",O,o(t)),t.REFRESH_COST=2,t.CARD_COUNT=4,t.currentCards=[],t.lastWave=0,t.waveSystem=null,t}n(t,e);var i=t.prototype;return i.start=function(){var e,t=null==(e=this.node.scene)?void 0:e.getChildByName("Canvas");if(t&&(this.waveSystem=t.getComponentInChildren(S)),!this.cardPrefab&&this.cardContainer){var n=this.cardContainer.getChildByName("ShopCard");n&&(this.cardPrefab=n)}this.refreshShop(),this.refreshButton&&this.refreshButton.node.on(d.EventType.CLICK,this.onRefreshClick,this),this.updateRefreshButton()},i.update=function(){if(this.waveSystem){var e=this.waveSystem.getCurrentWave();e>this.lastWave&&(this.lastWave=e,this.refreshShop())}this.updateRefreshButton()},i.refreshShop=function(){this.clearCards();for(var e=[].concat(v.TOWERS),t=0;t<this.CARD_COUNT&&0!==e.length;t++){var n=this.selectRandomTower(e);n&&this.createCard(n)}this.updateRefreshButton()},i.selectRandomTower=function(e){if(0===e.length)return null;for(var t=e.map((function(e){switch(e.rarity){case m.WHITE:return 3;case m.GREEN:return 2;case m.BLUE:default:return 1}})),n=t.reduce((function(e,t){return e+t}),0),r=Math.random()*n,o=0;o<e.length;o++)if((r-=t[o])<=0)return e[o];return e[0]},i.createCard=function(e){var t;if(this.cardContainer){var n;n=this.cardPrefab&&this.cardPrefab.uuid||this.cardPrefab?c(this.cardPrefab):this.createCardNode(),this.cardContainer.addChild(n);var r=this.currentCards.length;(n.getComponent(u)||n.addComponent(u)).setContentSize(140,130);var o=n.getComponent(C)||n.addComponent(C);o.isAlignLeft=!0,o.left=150*r+10,o.isAlignTop=!0,o.top=-5;var i=n.getComponent(y)||n.addComponent(y);i.setTowerData(e);var a=null==(t=n.getChildByName("BuyButton"))?void 0:t.getComponent(d);a&&a.node.on(d.EventType.CLICK,(function(){i.onBuyClick()}),this),this.currentCards.push({towerData:e,node:n})}},i.createCardNode=function(){var e=new s("ShopCard");e.addComponent(u).setContentSize(140,130);var t=new s("CardBackground");e.addChild(t),t.addComponent(u).setContentSize(140,130),t.addComponent(f).color=new p(60,60,80,255);var n=this.createLabelNode("NameLabel","防御塔",18);e.addChild(n);var r=n.addComponent(C);r.isAlignTop=!0,r.top=-5,r.isAlignLeft=!0,r.isAlignRight=!0,r.left=5,r.right=5;var o=this.createLabelNode("CostLabel","30",20);e.addChild(o);var i=o.addComponent(C);i.isAlignBottom=!0,i.bottom=30,i.isAlignLeft=!0,i.isAlignRight=!0;var a=this.createLabelNode("DescLabel","描述",12);e.addChild(a);var l=a.addComponent(C);l.isAlignTop=!0,l.top=-30,l.isAlignLeft=!0,l.isAlignRight=!0,l.left=5,l.right=5,a.getComponent(h).enableWrapText=!0;var c=new s("BuyButton");e.addChild(c),c.addComponent(u).setContentSize(120,25),c.addComponent(f).color=new p(50,200,50);var g=c.addComponent(d);g.transition=d.Transition.COLOR,g.normalColor=new p(50,200,50);var m=c.addComponent(C);m.isAlignBottom=!0,m.bottom=5,m.isAlignLeft=!0,m.isAlignRight=!0,m.left=10,m.right=10;var v=this.createLabelNode("Label","购买",14);c.addChild(v);var b=v.addComponent(C);return b.isAlignTop=!0,b.isAlignBottom=!0,b.isAlignLeft=!0,b.isAlignRight=!0,e},i.createLabelNode=function(e,t,n){var r=new s(e);r.addComponent(u).setContentSize(130,25);var o=r.addComponent(h);return o.string=t,o.fontSize=n,o.color=p.WHITE,o.horizontalAlign=h.HorizontalAlign.CENTER,o.verticalAlign=h.VerticalAlign.CENTER,r},i.onRefreshClick=function(){b.money>=this.REFRESH_COST&&(b.money-=this.REFRESH_COST,this.refreshShop())},i.updateRefreshButton=function(){this.refreshCostLabel&&(this.refreshCostLabel.string="刷新 ("+this.REFRESH_COST+")"),this.refreshButton&&(this.refreshButton.interactable=b.money>=this.REFRESH_COST)},i.clearCards=function(){this.currentCards.forEach((function(e){e.node&&e.node.isValid&&e.node.destroy()})),this.currentCards=[]},t}(g)).prototype,"shopPanel",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(N.prototype,"cardContainer",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=t(N.prototype,"cardPrefab",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(N.prototype,"refreshButton",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(N.prototype,"refreshCostLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=N))||E));i._RF.pop()}}}));

System.register("chunks:///_virtual/TileSlot.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,n,o,a,l,c,s,u,p,T,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.Enum,c=e.SpriteFrame,s=e.EDITOR,u=e.Sprite,p=e.Color,T=e.v3,f=e.Component}],execute:function(){var g,h,b,y,m,d,I,S,E,D,w,P;o._RF.push({},"b4b4d6RUK5LgL1fUSHgF46Z","TileSlot",void 0);var A=a.ccclass,k=a.property,v=a.executeInEditMode,R=e("TileType",function(e){return e[e.VOID=0]="VOID",e[e.PATH=1]="PATH",e[e.EMPTY=2]="EMPTY",e[e.START=3]="START",e[e.END=4]="END",e}({}));l(R);e("TileSlot",(g=A("TileSlot"),h=v(!0),b=k(c),y=k(c),m=k(c),d=k({type:R}),g(I=h((E=t((S=function(e){function t(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"grassImg",E,n(t)),i(t,"dirtImg",D,n(t)),i(t,"rockImg",w,n(t)),i(t,"type",P,n(t)),t.isOccupied=!1,t}r(t,e);var o=t.prototype;return o.update=function(){s&&this.updateVisual()},o.start=function(){this.updateVisual()},o.updateVisual=function(){var e=this.getComponent(u);if(e){if(s)switch(e.spriteFrame=null,this.type){case R.EMPTY:e.color=new p(50,150,50);break;case R.PATH:e.color=new p(150,100,50);break;case R.START:e.color=new p(50,50,200);break;case R.END:e.color=new p(200,50,50);break;case R.VOID:e.color=new p(80,80,80)}else{var t=null;switch(this.type){case R.EMPTY:t=this.grassImg;break;case R.PATH:case R.START:case R.END:t=this.dirtImg;break;case R.VOID:t=this.rockImg}t&&(e.spriteFrame=t,e.color=p.WHITE)}this.type===R.PATH||this.type===R.START||this.type===R.END?this.node.setScale(T(.96,.96,1)):this.node.setScale(T(1,1,1))}},t}(f)).prototype,"grassImg",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(S.prototype,"dirtImg",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(S.prototype,"rockImg",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(S.prototype,"type",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return R.EMPTY}}),I=S))||I)||I));o._RF.pop()}}}));

System.register("chunks:///_virtual/TouchManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileSlot.ts","./Tower.ts","./GameConfig.ts"],(function(e){var i,n,t,o,r,a,s,c,l,g,u,h,T,d,p,f,v,w,C,P,m;return{setters:[function(e){i=e.applyDecoratedDescriptor,n=e.inheritsLoose,t=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,s=e._decorator,c=e.Prefab,l=e.Camera,g=e.Label,u=e.v3,h=e.find,T=e.Node,d=e.UITransform,p=e.Vec3,f=e.instantiate,v=e.Component},function(e){w=e.TileType,C=e.TileSlot},function(e){P=e.Tower},function(e){m=e.GameConfig}],execute:function(){var O,y,E,I,M,b,_,L,D,A;a._RF.push({},"58e2fMnuN1I9ZsDxPPrcPbu","TouchManager",void 0);var S=s.ccclass,U=s.property;e("TouchManager",(O=S("TouchManager"),y=U(c),E=U(l),I=U(g),O(((A=function(e){function i(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,t(i,"towerPrefab",_,o(i)),t(i,"mainCamera",L,o(i)),t(i,"moneyLabel",D,o(i)),i.draggingTower=null,i.originalTilePos=u(),i.canvas=null,i.gridMap=null,i}n(i,e);var a=i.prototype;return a.start=function(){this.canvas=h("Canvas"),this.gridMap=h("Canvas/GridMap"),this.node.on(T.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(T.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(T.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(T.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},a.update=function(){this.moneyLabel&&(this.moneyLabel.string="GOLD: "+i.money)},a.getUIPos=function(e){var i=e.getUILocation(),n=this.node.getComponent(d);return n?n.convertToNodeSpaceAR(u(i.x,i.y,0)):u()},a.onTouchStart=function(e){if(!i.isGameOver){var n=this.getUIPos(e),t=this.getTileAtPos(n);if(t){var o=t.node,r=t.script,a=this.getTowerOnTile(o.getPosition());if(a)return this.draggingTower=a,this.originalTilePos=o.getPosition().clone(),void this.draggingTower.setSiblingIndex(99);r.type!==w.EMPTY||r.isOccupied||(i.pendingTowerData?(this.spawnTower(o.getPosition(),i.pendingTowerData),r.isOccupied=!0,i.pendingTowerData=null):i.money>=m.TOWER_COST&&(this.spawnTower(o.getPosition()),r.isOccupied=!0,i.money-=m.TOWER_COST))}}},a.onTouchMove=function(e){this.draggingTower&&this.draggingTower.setPosition(this.getUIPos(e))},a.onTouchEnd=function(e){if(this.draggingTower){var i=this.getUIPos(e),n=this.getTileAtPos(i),t=!1;if(n){var o=n.node,r=n.script,a=this.getTowerOnTile(o.getPosition());if(a&&a!==this.draggingTower){var s=this.draggingTower.getComponent(P),c=a.getComponent(P);s&&c&&s.towerId===c.towerId&&s.level===c.level&&s.level<s.MAX_LEVEL&&(c.absorb(s),this.clearOccupied(this.originalTilePos),this.draggingTower.destroy(),t=!0)}else a||r.type!==w.EMPTY||r.isOccupied||(r.isOccupied=!0,this.clearOccupied(this.originalTilePos),t=!0)}t||this.draggingTower.setPosition(this.originalTilePos),this.draggingTower=null}},a.clearOccupied=function(e){this.gridMap||(this.gridMap=h("Canvas/GridMap")),this.gridMap&&this.gridMap.children.forEach((function(i){if(p.distance(i.getPosition(),e)<m.OCCUPIED_CLEAR_DISTANCE){var n=i.getComponent(C);n&&(n.isOccupied=!1)}}))},a.getTileAtPos=function(e){if(this.gridMap||(this.gridMap=h("Canvas/GridMap")),!this.gridMap)return null;for(var i,n=r(this.gridMap.children);!(i=n()).done;){var t=i.value;if(p.distance(t.getPosition(),e)<m.TILE_DETECTION_RADIUS){var o=t.getComponent(C);if(o)return{node:t,script:o}}}return null},a.getTowerOnTile=function(e){return this.canvas||(this.canvas=h("Canvas")),this.canvas&&this.canvas.children.find((function(i){return"Tower_Instance"===i.name&&i.isValid&&p.distance(i.getPosition(),e)<m.TOWER_DETECTION_RADIUS}))||null},a.spawnTower=function(e,i){if(this.canvas||(this.canvas=h("Canvas")),this.canvas){var n=f(this.towerPrefab);if(this.canvas.addChild(n),n.name="Tower_Instance",n.setPosition(e),i){var t=n.getComponent(P);t&&t.init(i)}}},i.onBuyTowerFromShop=function(e,n){var t=h("Canvas"),o=null==t?void 0:t.getComponentInChildren(i);o&&n&&o.spawnTower(n,e)},i}(v)).money=m.INITIAL_MONEY,A.baseHealth=m.INITIAL_HEALTH,A.isGameOver=!1,A.pendingTowerData=null,_=i((b=A).prototype,"towerPrefab",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=i(b.prototype,"mainCamera",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=i(b.prototype,"moneyLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=b))||M));a._RF.pop()}}}));

System.register("chunks:///_virtual/Tower.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Bullet.ts","./GameConfig.ts","./TowerType.ts","./Enemy.ts"],(function(t){var e,i,a,n,r,s,l,o,h,u,c,f,v,d,p,g,m,w,E;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,a=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,s=t._decorator,l=t.Prefab,o=t.Label,h=t.Sprite,u=t.find,c=t.v3,f=t.instantiate,v=t.Vec3,d=t.Component},function(t){p=t.Bullet},function(t){g=t.GameConfig},function(t){m=t.TowerConfig,w=t.SkillType},function(t){E=t.Enemy}],execute:function(){var b,D,k,T,y,L,I,S,A;r._RF.push({},"b01cclZ9oNEy41ADiCpQpwJ","Tower",void 0);var P=s.ccclass,C=s.property;t("Tower",(b=P("Tower"),D=C(l),k=C(o),T=C(h),b((I=e((L=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,a(e,"bulletPrefab",I,n(e)),a(e,"levelLabel",S,n(e)),a(e,"towerSprite",A,n(e)),e.towerData=null,e.towerId="",e.level=1,e.currentExp=0,e.nextLevelNeeded=2,e.MAX_LEVEL=4,e.attackTimer=0,e.skillTimer=0,e.range=250,e.damage=1,e.attackInterval=1.2,e.canvas=null,e}i(e,t);var r=e.prototype;return r.init=function(t){this.towerData=t,this.towerId=t.id,this.level=1,this.currentExp=0,this.nextLevelNeeded=2,this.range=t.baseRange,this.damage=t.baseDamage,this.attackInterval=t.baseAttackInterval,this.updateUI(),this.updateAppearance()},r.start=function(){if(this.canvas=u("Canvas"),!this.towerData&&this.towerId){var t=m.getTowerData(this.towerId);t&&this.init(t)}this.updateUI()},r.absorb=function(t){if(!(this.level>=this.MAX_LEVEL)&&t.towerId===this.towerId&&t.level===this.level){if(this.currentExp+=1,this.currentExp>=this.nextLevelNeeded){var e,i;this.level++,this.currentExp=0,this.nextLevelNeeded=this.level+1;var a=1+.2*(this.level-1);this.damage=((null==(e=this.towerData)?void 0:e.baseDamage)||1)*a,this.attackInterval=Math.max(.3,((null==(i=this.towerData)?void 0:i.baseAttackInterval)||1.2)-.1*(this.level-1))}this.updateUI()}},r.updateUI=function(){if(this.levelLabel){var t=this.level>=this.MAX_LEVEL?"MAX":this.currentExp+"/"+this.nextLevelNeeded;this.levelLabel.string="LV."+this.level+"\n"+t}var e=1+(this.level-1)*g.TOWER_SCALE_PER_LEVEL;this.node.setScale(c(e,e,1))},r.updateAppearance=function(){if(this.towerSprite&&this.towerData){var t=m.getRarityColor(this.towerData.rarity);this.towerSprite.color=t}if(this.towerData){var e=m.getRarityName(this.towerData.rarity);this.node.name=this.towerData.name+"_"+e+"_LV"+this.level}},r.update=function(t){if(this.attackTimer+=t,this.skillTimer+=t,this.attackTimer>=this.attackInterval&&(this.shoot(),this.attackTimer=0),this.towerData&&this.towerData.skillType!==w.NONE){var e=this.towerData.skillCooldown||0;e>0&&this.skillTimer>=e&&(this.useSkill(),this.skillTimer=0)}},r.shoot=function(){var t=this.findNearestEnemy();if(t&&this.bulletPrefab&&(this.canvas||(this.canvas=u("Canvas")),this.canvas)){var e=f(this.bulletPrefab);this.canvas.addChild(e),e.setPosition(this.node.getPosition());var i=e.getComponent(p);i&&(i.setTarget(t),i.damage=this.damage,this.towerData&&(i.towerData=this.towerData,i.towerLevel=this.level))}},r.useSkill=function(){if(this.towerData&&this.canvas){var t=this.towerData.skillType,e=this.towerData.skillValue;switch(t){case w.AOE_DAMAGE:this.useAOESkill(e);break;case w.BUFF_DAMAGE:this.useBuffDamageSkill(e);break;case w.BUFF_SPEED:this.useBuffSpeedSkill(e)}}},r.useAOESkill=function(t){var e=this;this.findEnemiesInRange(this.range).forEach((function(i){var a=i.getComponent(E);a&&a.takeDamage(e.damage*t)}))},r.useBuffDamageSkill=function(t){var i=this;this.findTowersInRange(1.5*this.range).forEach((function(a){var n=a.getComponent(e);n&&n!==i&&(n.damageBuff=t,n.buffTimer=5)}))},r.useBuffSpeedSkill=function(t){var i=this;this.findTowersInRange(1.5*this.range).forEach((function(a){var n=a.getComponent(e);n&&n!==i&&(n.speedBuff=t,n.buffTimer=5)}))},r.findEnemiesInRange=function(t){if(!this.canvas)return[];var e=this.node.getPosition();return this.canvas.children.filter((function(i){return!("Enemy"!==i.name||!i.isValid)&&v.distance(e,i.getPosition())<=t}))},r.findTowersInRange=function(t){var e=this;if(!this.canvas)return[];var i=this.node.getPosition();return this.canvas.children.filter((function(a){return!(!a.name.includes("Tower_Instance")||!a.isValid||a===e.node)&&v.distance(i,a.getPosition())<=t}))},r.findNearestEnemy=function(){if(this.canvas||(this.canvas=u("Canvas")),!this.canvas)return null;var t=this.canvas.children.filter((function(t){return"Enemy"===t.name&&t.isValid}));if(0===t.length)return null;var e=null,i=this.range,a=this.node.getPosition();return t.forEach((function(t){var n=v.distance(a,t.getPosition());n<i&&(i=n,e=t)})),e},e}(d)).prototype,"bulletPrefab",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(L.prototype,"levelLabel",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(L.prototype,"towerSprite",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=L))||y));r._RF.pop()}}}));

System.register("chunks:///_virtual/TowerType.ts",["cc"],(function(e){var a,t,r;return{setters:[function(e){a=e.cclegacy,t=e.Enum,r=e.Color}],execute:function(){a._RF.push({},"9f1c7BvNbFIoqw9Mqu+cJXu","TowerType",void 0);var n=e("TowerRarity",function(e){return e[e.WHITE=0]="WHITE",e[e.GREEN=1]="GREEN",e[e.BLUE=2]="BLUE",e}({}));t(n);var i=e("TowerCategory",function(e){return e[e.PHYSICAL=0]="PHYSICAL",e[e.MAGIC=1]="MAGIC",e[e.SUPPORT=2]="SUPPORT",e[e.AOE=3]="AOE",e}({}));t(i);var s=e("SkillType",function(e){return e[e.NONE=0]="NONE",e[e.AOE_DAMAGE=1]="AOE_DAMAGE",e[e.SLOW=2]="SLOW",e[e.BUFF_DAMAGE=3]="BUFF_DAMAGE",e[e.BUFF_SPEED=4]="BUFF_SPEED",e[e.CHAIN=5]="CHAIN",e[e.SPLASH=6]="SPLASH",e}({}));t(s),e("TowerConfig",function(){function e(){}return e.getTowerData=function(e){return this.TOWERS.find((function(a){return a.id===e}))||null},e.getRarityColor=function(e){switch(e){case n.WHITE:return r.WHITE;case n.GREEN:return new r(50,255,50,255);case n.BLUE:return new r(50,150,255,255);default:return r.WHITE}},e.getRarityName=function(e){switch(e){case n.WHITE:return"普通";case n.GREEN:return"精良";case n.BLUE:return"稀有";default:return"未知"}},e}()).TOWERS=[{id:"tower_archer",name:"弓箭手",rarity:n.WHITE,category:i.PHYSICAL,baseCost:30,baseDamage:1,baseAttackInterval:1,baseRange:250,skillType:s.NONE,skillValue:0,description:"基础物理攻击塔"},{id:"tower_mage",name:"法师",rarity:n.WHITE,category:i.MAGIC,baseCost:35,baseDamage:1.2,baseAttackInterval:1.2,baseRange:280,skillType:s.NONE,skillValue:0,description:"基础魔法攻击塔"},{id:"tower_guard",name:"守卫",rarity:n.WHITE,category:i.PHYSICAL,baseCost:40,baseDamage:1.5,baseAttackInterval:1.5,baseRange:200,skillType:s.NONE,skillValue:0,description:"高伤害但攻击较慢"},{id:"tower_ice",name:"寒冰塔",rarity:n.GREEN,category:i.SUPPORT,baseCost:60,baseDamage:.8,baseAttackInterval:.8,baseRange:300,skillType:s.SLOW,skillValue:.3,skillCooldown:0,description:"攻击附带减速效果"},{id:"tower_cannon",name:"火炮",rarity:n.GREEN,category:i.AOE,baseCost:70,baseDamage:2,baseAttackInterval:2,baseRange:280,skillType:s.SPLASH,skillValue:.5,skillCooldown:0,description:"范围溅射伤害"},{id:"tower_lightning",name:"闪电塔",rarity:n.BLUE,category:i.MAGIC,baseCost:100,baseDamage:1.5,baseAttackInterval:1,baseRange:320,skillType:s.CHAIN,skillValue:3,skillCooldown:3,description:"连锁攻击多个敌人"}],a._RF.pop()}}}));

System.register("chunks:///_virtual/UIBuilder.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShopSystem.ts"],(function(t){var e,n,a,i,o,r,l,d,s,p,h,c,C,g,m,v,u,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){o=t.cclegacy,r=t._decorator,l=t.Node,d=t.SpriteFrame,s=t.find,p=t.UITransform,h=t.Widget,c=t.Sprite,C=t.Color,g=t.v3,m=t.Button,v=t.Label,u=t.Component},function(t){f=t.ShopSystem}],execute:function(){var b,A,L,B,S,w,T,R,z,y,I;o._RF.push({},"b6ac5B0nRdOhInoMfv2lL7d","UIBuilder",void 0);var U=r.ccclass,M=r.property;t("UIBuilder",(b=U("UIBuilder"),A=M(l),L=M(d),B=M(d),S=M(d),b((R=e((T=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o))||this,a(e,"canvas",R,i(e)),a(e,"buttonSprite",z,i(e)),a(e,"cardBgSprite",y,i(e)),a(e,"panelBgSprite",I,i(e)),e}n(e,t);var o=e.prototype;return o.start=function(){this.canvas||(this.canvas=s("Canvas")),this.canvas&&this.buildAllUI()},o.buildAllUI=function(){this.createTopBar(),this.createShopUI(),this.createGameOverUI()},o.createTopBar=function(){var t=new l("TopBar");this.canvas.addChild(t),t.addComponent(p).setContentSize(750,100);var e=t.addComponent(h);e.isAlignTop=!0,e.top=0,e.isAlignLeft=!0,e.isAlignRight=!0,e.left=0,e.right=0;var n=new l("Background");t.addChild(n),n.addComponent(p).setContentSize(750,100),n.addComponent(c).color=new C(0,0,0,180);var a=this.createLabel("MoneyLabel","MONEY: 200",24,new C(255,215,0));t.addChild(a);var i=a.addComponent(h);i.isAlignLeft=!0,i.left=20,i.isAlignTop=!0,i.top=-20;var o=this.createLabel("HealthLabel","HP: 10",24,new C(255,50,50));t.addChild(o);var r=o.addComponent(h);r.isAlignLeft=!0,r.left=20,r.isAlignTop=!0,r.top=-50;var d=this.createLabel("WaveLabel","WAVE: 1/30",24,new C(255,255,255));t.addChild(d);var s=d.addComponent(h);s.isAlignRight=!0,s.right=20,s.isAlignTop=!0,s.top=-35},o.createShopUI=function(){var t=new l("ShopPanel");this.canvas.addChild(t),t.addComponent(p).setContentSize(750,200);var e=t.addComponent(h);e.isAlignBottom=!0,e.bottom=0,e.isAlignLeft=!0,e.isAlignRight=!0,e.left=0,e.right=0;var n=new l("PanelBackground");t.addChild(n),n.addComponent(p).setContentSize(750,200),n.addComponent(c).color=new C(30,30,30,220);var a=this.createLabel("ShopTitle","商店",28,new C(255,255,255));t.addChild(a);var i=a.addComponent(h);i.isAlignTop=!0,i.top=-10,i.isAlignLeft=!0,i.left=20;var o=new l("CardContainer");t.addChild(o),o.addComponent(p).setContentSize(600,140);var r=o.addComponent(h);r.isAlignLeft=!0,r.left=20,r.isAlignBottom=!0,r.bottom=10;var d=this.createButton("RefreshButton","刷新 (2)",20,new C(100,150,255));t.addChild(d);var s=d.addComponent(h);s.isAlignRight=!0,s.right=20,s.isAlignBottom=!0,s.bottom=10,d.setScale(g(1.2,1.2,1));var u=this.createLabel("RefreshCostLabel","刷新 (2)",18,new C(255,255,255));d.addChild(u);var b=this.createShopCardPrefab();o.addChild(b),b.active=!1;var A=this.canvas.getComponent(f)||this.canvas.addComponent(f);A.shopPanel=t,A.cardContainer=o,A.cardPrefab=b,A.refreshButton=d.getComponent(m),A.refreshCostLabel=u.getComponent(v)},o.createShopCardPrefab=function(){var t=new l("ShopCard");t.addComponent(p).setContentSize(140,130);var e=new l("CardBackground");t.addChild(e),e.addComponent(p).setContentSize(140,130),e.addComponent(c).color=new C(60,60,80,255);var n=this.createLabel("NameLabel","防御塔",18,new C(255,255,255));t.addChild(n);var a=n.addComponent(h);a.isAlignTop=!0,a.top=-5,a.isAlignLeft=!0,a.isAlignRight=!0,a.left=5,a.right=5;var i=this.createLabel("CostLabel","30",20,new C(255,215,0));t.addChild(i);var o=i.addComponent(h);o.isAlignBottom=!0,o.bottom=30,o.isAlignLeft=!0,o.isAlignRight=!0;var r=this.createLabel("DescLabel","描述",12,new C(200,200,200));t.addChild(r);var d=r.addComponent(h);d.isAlignTop=!0,d.top=-30,d.isAlignLeft=!0,d.isAlignRight=!0,d.left=5,d.right=5,r.getComponent(v).enableWrapText=!0;var s=this.createButton("BuyButton","购买",16,new C(50,200,50));t.addChild(s);var m=s.addComponent(h);return m.isAlignBottom=!0,m.bottom=5,m.isAlignLeft=!0,m.isAlignRight=!0,m.left=10,m.right=10,s.setScale(g(.9,.8,1)),t},o.createGameOverUI=function(){var t=new l("GameOverPanel");this.canvas.addChild(t),t.active=!1,t.addComponent(p).setContentSize(750,1334);var e=t.addComponent(h);e.isAlignTop=!0,e.isAlignBottom=!0,e.isAlignLeft=!0,e.isAlignRight=!0;var n=new l("Background");t.addChild(n),n.addComponent(p).setContentSize(750,1334),n.addComponent(c).color=new C(0,0,0,200);var a=this.createLabel("GameOverText","游戏结束",48,new C(255,50,50));t.addChild(a);var i=a.addComponent(h);i.isAlignTop=!0,i.top=-200,i.isAlignLeft=!0,i.isAlignRight=!0;var o=this.createButton("ResetButton","重新开始",24,new C(100,150,255));t.addChild(o);var r=o.addComponent(h);r.isAlignTop=!0,r.top=-300,r.isAlignLeft=!0,r.isAlignRight=!0,r.left=200,r.right=200,o.setScale(g(1.5,1.5,1))},o.createLabel=function(t,e,n,a){var i=new l(t);i.addComponent(p).setContentSize(200,30);var o=i.addComponent(v);return o.string=e,o.fontSize=n,o.color=a,o.isBold=!0,i},o.createButton=function(t,e,n,a){var i=new l(t);i.addComponent(p).setContentSize(120,40),i.addComponent(c).color=a;var o=i.addComponent(m);o.transition=m.Transition.COLOR,o.normalColor=a,o.hoverColor=new C(Math.min(255,a.r+30),Math.min(255,a.g+30),Math.min(255,a.b+30)),o.pressedColor=new C(Math.max(0,a.r-30),Math.max(0,a.g-30),Math.max(0,a.b-30));var r=this.createLabel("Label",e,n,C.WHITE);i.addChild(r);var d=r.addComponent(h);return d.isAlignTop=!0,d.isAlignBottom=!0,d.isAlignLeft=!0,d.isAlignRight=!0,i},e}(u)).prototype,"canvas",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(T.prototype,"buttonSprite",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=e(T.prototype,"cardBgSprite",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(T.prototype,"panelBgSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=T))||w));o._RF.pop()}}}));

System.register("chunks:///_virtual/UIController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TouchManager.ts","./GameConfig.ts","./LevelManager.ts","./WaveSystem.ts"],(function(e){var n,t,i,r,a,o,l,s,u,c,h,f,p,v,d;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,l=e.Label,s=e.Node,u=e.find,c=e.director,h=e.Component},function(e){f=e.TouchManager},function(e){p=e.GameConfig},function(e){v=e.LevelManager},function(e){d=e.WaveSystem}],execute:function(){var m,g,b,w,y,C,L,T,H,I,S,B,M;a._RF.push({},"c6a63J3FxhH4IS87k0d1T3X","UIController",void 0);var E=o.ccclass,G=o.property;e("UIController",(m=E("UIController"),g=G(l),b=G(l),w=G(l),y=G(s),C=G(s),m((H=n((T=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return n=e.call.apply(e,[this].concat(a))||this,i(n,"moneyLabel",H,r(n)),i(n,"healthLabel",I,r(n)),i(n,"waveLabel",S,r(n)),i(n,"resetButton",B,r(n)),i(n,"pendingTowerHint",M,r(n)),n.waveSystem=null,n}t(n,e);var a=n.prototype;return a.start=function(){var e;this.resetButton&&(this.resetButton.active=!1),this.pendingTowerHint&&(this.pendingTowerHint.active=!1),this.waveSystem=(null==(e=u("Canvas"))?void 0:e.getComponentInChildren(d))||null},a.update=function(){if(this.moneyLabel&&(this.moneyLabel.string="MONEY: "+f.money),this.healthLabel&&(this.healthLabel.string="HP: "+f.baseHealth),this.waveLabel&&this.waveSystem){var e=this.waveSystem.getCurrentWave();this.waveLabel.string="WAVE: "+e+"/30"}if(this.pendingTowerHint&&(this.pendingTowerHint.active=null!==f.pendingTowerData,f.pendingTowerData&&this.pendingTowerHint)){var n=this.pendingTowerHint.getComponentInChildren(l);n&&(n.string="请点击地图放置："+f.pendingTowerData.name)}f.baseHealth<=0&&!f.isGameOver&&(f.isGameOver=!0,this.showResetMenu())},a.showResetMenu=function(){this.resetButton&&(this.resetButton.active=!0)},a.onResetButtonClick=function(){var e;this.cleanupGameObjects();var n=null==(e=u("Canvas"))?void 0:e.getComponent(v);if(n)n.reloadCurrentLevel();else{var t;f.money=p.INITIAL_MONEY,f.baseHealth=p.INITIAL_HEALTH,f.isGameOver=!1;var i=null==(t=c.getScene())?void 0:t.name;i&&c.loadScene(i)}},a.cleanupGameObjects=function(){var e=u("Canvas");if(e){e.children.filter((function(e){return"Enemy"===e.name})).forEach((function(e){e.isValid&&e.destroy()})),e.children.filter((function(e){return e.name.includes("Bullet")||e.getComponent("Bullet")})).forEach((function(e){e.isValid&&e.destroy()})),e.children.filter((function(e){return"Tower_Instance"===e.name||e.name.includes("Tower")})).forEach((function(e){e.isValid&&e.destroy()}));var n=u("Canvas/GridMap");n&&n.children.forEach((function(e){var n=e.getComponent("TileSlot");n&&(n.isOccupied=!1)}))}},n}(h)).prototype,"moneyLabel",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=n(T.prototype,"healthLabel",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=n(T.prototype,"waveLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(T.prototype,"resetButton",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=n(T.prototype,"pendingTowerHint",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=T))||L));a._RF.pop()}}}));

System.register("chunks:///_virtual/WaveSystem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TileSlot.ts","./Enemy.ts","./TouchManager.ts","./ShopSystem.ts"],(function(e){var t,i,n,a,s,r,o,h,l,p,u,v,f,y,c,m,T,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,s=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy,o=e._decorator,h=e.Prefab,l=e.Label,p=e.find,u=e.instantiate,v=e.Component},function(e){f=e.TileSlot,y=e.TileType},function(e){c=e.EnemyType,m=e.Enemy},function(e){T=e.TouchManager},function(e){g=e.ShopSystem}],execute:function(){var w,E,S,b,d,A,W,L,C,M,P;r._RF.push({},"40a74Nu3FNFnJlyUdOmLjFf","WaveSystem",void 0);var O=o.ccclass,N=o.property;e("WaveSystem",(w=O("WaveSystem"),E=N(h),S=N(h),b=N(h),d=N(l),w((L=t((W=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t=e.call.apply(e,[this].concat(s))||this,n(t,"enemyPrefab",L,a(t)),n(t,"eliteEnemyPrefab",C,a(t)),n(t,"bossEnemyPrefab",M,a(t)),n(t,"waveLabel",P,a(t)),t.TOTAL_WAVES=30,t.ELITE_WAVES=[15,25],t.BOSS_WAVE=30,t.currentWave=1,t.waveConfigs=[],t.enemiesLeftToSpawn=0,t.spawnTimer=0,t.waveGapTimer=0,t.canvas=null,t.gridMap=null,t.shopSystem=null,t}i(t,e);var r=t.prototype;return r.start=function(){var e;this.canvas=p("Canvas"),this.gridMap=p("Canvas/GridMap"),this.shopSystem=(null==(e=p("Canvas"))?void 0:e.getComponentInChildren(g))||null,this.initWaveConfigs(),this.startWave(1)},r.initWaveConfigs=function(){for(var e=1;e<=this.TOTAL_WAVES;e++){var t=this.ELITE_WAVES.includes(e),i=e===this.BOSS_WAVE,n=void 0,a=void 0,s=void 0;i?(n=1,a=0,s=[{type:c.TANK,weight:1}]):t?(n=3+Math.floor(e/5),a=2,s=[{type:c.TANK,weight:.6},{type:c.NORMAL,weight:.4}]):(n=5+Math.floor(1.5*e),a=Math.max(.5,1.5-.02*e),s=this.getEnemyTypesForWave(e)),this.waveConfigs.push({waveNumber:e,enemyCount:n,enemyTypes:s,spawnInterval:a,isElite:t,isBoss:i})}},r.getEnemyTypesForWave=function(e){return e<=5?[{type:c.NORMAL,weight:1}]:e<=10?[{type:c.NORMAL,weight:.7},{type:c.FAST,weight:.3}]:e<=20?[{type:c.NORMAL,weight:.5},{type:c.FAST,weight:.3},{type:c.TANK,weight:.2}]:[{type:c.NORMAL,weight:.4},{type:c.FAST,weight:.3},{type:c.TANK,weight:.3}]},r.startWave=function(e){if(e>this.TOTAL_WAVES)console.log("恭喜！所有波次完成！");else{this.currentWave=e;var t=this.waveConfigs[e-1];if(t){if(this.enemiesLeftToSpawn=t.enemyCount,this.spawnTimer=0,this.waveGapTimer=0,this.waveLabel){var i="WAVE: "+e+"/"+this.TOTAL_WAVES;t.isBoss?i+=" [BOSS]":t.isElite&&(i+=" [ELITE]"),this.waveLabel.string=i}this.shopSystem&&this.shopSystem.refreshShop()}else console.error("波次配置不存在: "+e)}},r.update=function(e){if(!T.isGameOver){var t,i=this.waveConfigs[this.currentWave-1];if(i)if(this.enemiesLeftToSpawn>0)this.spawnTimer+=e,this.spawnTimer>=i.spawnInterval&&(this.spawnEnemy(i),this.enemiesLeftToSpawn--,this.spawnTimer=0);else if(this.canvas||(this.canvas=p("Canvas")),0===((null==(t=this.canvas)?void 0:t.children.filter((function(e){return"Enemy"===e.name})))||[]).length){this.waveGapTimer+=e;var n=i.isBoss?6:i.isElite?5:4;this.waveGapTimer>=n&&this.startWave(this.currentWave+1)}}},r.spawnEnemy=function(e){if(this.gridMap||(this.gridMap=p("Canvas/GridMap")),this.gridMap){var t=this.gridMap.children.find((function(e){var t=e.getComponent(f);return t&&t.type===y.START}));if(t){var i=this.selectEnemyType(e.enemyTypes),n=this.enemyPrefab;e.isBoss&&this.bossEnemyPrefab?n=this.bossEnemyPrefab:e.isElite&&this.eliteEnemyPrefab&&(n=this.eliteEnemyPrefab);var a=u(n);if(this.canvas||(this.canvas=p("Canvas")),this.canvas){this.canvas.addChild(a),a.name="Enemy",a.setPosition(t.getPosition());var s=a.getComponent(m);if(s){var r=this.currentWave;e.isBoss?r*=3:e.isElite&&(r*=1.5),s.init(r,i)}}else a.destroy()}}},r.selectEnemyType=function(e){for(var t,i=e.reduce((function(e,t){return e+t.weight}),0),n=Math.random()*i,a=s(e);!(t=a()).done;){var r=t.value;if((n-=r.weight)<=0)return r.type}return e[0].type},r.getCurrentWave=function(){return this.currentWave},t}(v)).prototype,"enemyPrefab",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(W.prototype,"eliteEnemyPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=t(W.prototype,"bossEnemyPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(W.prototype,"waveLabel",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=W))||A));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});